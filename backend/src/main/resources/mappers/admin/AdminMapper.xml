<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.admin.the_climbing_night.admin.mapper.AdminMapper">
  <select id="getMembers" parameterType="com.admin.the_climbing_night.admin.domain.req.GetMembersRequest" resultType="com.admin.the_climbing_night.admin.vo.GetMemberVo">
    SELECT
        m.id
        , m.name
        , m.birthDt
        , l.level
        , l.color
        , d.degree
    FROM
        member m
        join level l on m.levelFk = l.id
        join degree d on m.degreeFk = d.id
    WHERE
        1 = 1
        <if test="name != null and name != ''">AND m.name LIKE CONCAT('%', #{name}, '%')</if>
        <if test="birthDt != null and birthDt != ''">AND m.birthDt LIKE CONCAT('%', #{birthDt}, '%')</if>
        <if test="levelFk != null and levelFk != ''">AND m.levelFk = #{levelFk}</if>
        <if test="degreeFk != null and degreeFk != ''">AND m.degreeFk = #{degreeFk}</if>
        <if test="phoneNo != null and phoneNo != ''">AND m.phoneNo LIKE CONCAT('%', #{phoneNo}, '%')</if>
        <if test="winwinYn != null and winwinYn != ''">AND m.winwinYn = #{winwinYn}</if>
        <if test="sex != null and sex != ''">AND m.sex = #{sex}</if>
        <if test="blackCnt != null and blackCnt != ''">AND m.blackCnt >= #{blackCnt}</if>
        <if test="dormancyYn != null and dormancyYn != ''">AND m.dormancyYn = #{dormancyYn}</if>
        <if test="leaveYn != null and leaveYn != ''">AND m.leaveYn = #{leaveYn}</if>
        <if test="banYn != null and banYn != ''">AND m.banYn = #{banYn}</if>
  </select>

  <select id="isAdminMember" parameterType="com.admin.the_climbing_night.admin.domain.req.IsAdminMemberRequest" resultType="java.lang.String">
    SELECT
        a.id
    FROM
        admin a
        join member m on a.memberFk = m.id
    WHERE
        1 = 1
        <if test="name != null and name != ''">m.name = #{name}</if>
        <if test="birthDt != null and birthDt != ''">, m.birthDt = #{birthDt}</if>
        <if test="levelFk != null and levelFk != ''">, m.levelFk = #{levelFk}</if>
        <if test="degree != null and degree != ''">, m.degreeFk = #{degree}</if>
  </select>

  <update id="updateAuthority" parameterType="com.admin.the_climbing_night.admin.domain.req.IsAdminMemberRequest">
    UPDATE
        admin 
    SET
        grade = #{grade}
    WHERE
        1 = 1
        AND memberId = #{memberId}
  </update>

  <select id="isMember" parameterType="com.admin.the_climbing_night.admin.vo.IsMemberForAdminVo" resultType="java.lang.String">
    SELECT
        id
    FROM
        member
    WHERE
        1 = 1
        AND id = #{id}
        AND name = #{name}
        AND birthDt = #{birthDt}
  </select>
  
  <insert id="insertMember" parameterType="com.admin.the_climbing_night.admin.domain.req.InsertMemberRequest">
    INSERT INTO member (
        id
        , name
        , birthDt
        , levelFk
        , degreeFk
        , winwinYn
        , sex
        , blackCnt
        , dormancyYn
        , leaveYn
        , banYn
        , joinDt
        , createDt
    ) VALUES (
        #{id}
        , #{name}
        , #{birthDt}
        , #{levelFk}
        , #{degree}
        , #{winwinYn}
        , #{sex}
        , #{blackCnt}
        , #{dormancyYn}
        , #{leaveYn}
        , #{banYn}
        , #{joinDt}
        , #{createDt}
    )
  </insert>


  <update id="updateMember" parameterType="com.admin.the_climbing_night.admin.domain.req.UpdateMemberRequest">
    UPDATE
        member
    <set>
        <if test="name != null and name != ''">name = #{name}</if>
        <if test="birthDt != null and birthDt != ''">, birthDt = #{birthDt}</if>
        <if test="levelFk != null and levelFk != ''">, levelFk = #{levelFk}</if>
        <if test="degree != null and degree != ''">, degreeFk = #{degree}</if>
        <if test="phoneNo != null and phoneNo != ''">, phoneNo = #{phoneNo}</if>
        <if test="winwinYn != null and winwinYn != ''">, winwinYn = #{winwinYn}</if>
        <if test="sex != null and sex != ''">, sex = #{sex}</if>
        <if test="blackCnt != null and blackCnt != ''">, blackCnt = #{blackCnt}</if>
        <if test="dormancyYn != null and dormancyYn != ''">, dormancyYn = #{dormancyYn}</if>
        <if test="leaveYn != null and leaveYn != ''">, leaveYn = #{leaveYn}</if>
        <if test="banYn != null and banYn != ''">, banYn = #{banYn}</if>
        <if test="joinDt != null and joinDt != ''">, joinDt = #{joinDt}</if>
        <if test="updateDt != null and updateDt != ''">, updateDt = #{updateDt}</if>
        <if test="leaveDt != null and leaveDt != ''">, leaveDt = #{leaveDt}</if>
        <if test="banDt != null and banDt != ''">, banDt = #{banDt}</if>
        <if test="image != null and image != ''">, image = #{image}</if>
        <if test="updateReason != null and updateReason != ''">, updateReason = #{updateReason}</if>
        <if test="dormancyReason != null and dormancyReason != ''">, dormancyReason = #{dormancyReason}</if>
        <if test="leaveReason != null and leaveReason != ''">, leaveReason = #{leaveReason}</if>
        <if test="banReason != null and banReason != ''">, banReason = #{banReason}</if>
    </set>
    WHERE
        1 = 1
        AND id = #{id}
  </update>
</mapper>